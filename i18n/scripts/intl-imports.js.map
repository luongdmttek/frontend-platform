{"version":3,"file":"intl-imports.js","names":["scriptHelpDocument","fs","require","path","camelCase","loggingPrefix","basename","concat","__filename","filesCodeGeneratorNoticeHeader","generateSubdirectoryMessageFile","_ref","directory","log","writeFileSync","i18nDir","importLines","messagesLines","counter","nonEmptyLanguages","messagesDir","files","readdirSync","withFileTypes","sort","jsonFiles","filter","file","isFile","name","endsWith","length","isWritten","forEach","filename","languageCode","replace","reactIntlLanguageCode","toLowerCase","messagesCamelCaseVar","filePath","entries","JSON","parse","readFileSync","encoding","Object","keys","push","e","splice","messagesFileContent","join","generateMainMessagesFile","_ref2","processedDirectories","exportLines","processedDirectory","moduleCamelCaseVariableName","skipMessage","indexFileContent","main","_ref3","directories","pwd","includes","existsSync","lstatSync","isDirectory","map","module","process","argv","slice","text","stdout","write","env","PWD","exports"],"sources":["../../../src/i18n/scripts/intl-imports.js"],"sourcesContent":["#!/usr/bin/env node\r\n\r\nconst scriptHelpDocument = `\r\nNAME\r\n  intl-imports.js — Script to generate the src/i18n/index.js file that exports messages from all the languages for Micro-frontends.\r\n\r\nSYNOPSIS\r\n  intl-imports.js [DIRECTORY ...]\r\n\r\nDESCRIPTION\r\n  This script is intended to run after 'atlas' has pulled the files.\r\n  \r\n  This expects to run inside a Micro-frontend root directory with the following structure:\r\n  \r\n    frontend-app-learning $ tree src/i18n/\r\n    src/i18n/\r\n    ├── index.js\r\n    └── messages\r\n        ├── frontend-app-example\r\n        │   ├── ar.json\r\n        │   ├── es_419.json\r\n        │   └── zh_CN.json\r\n        ├── frontend-component-footer\r\n        │   ├── ar.json\r\n        │   ├── es_419.json\r\n        │   └── zh_CN.json\r\n        └── frontend-component-header (empty directory)\r\n  \r\n  \r\n  \r\n  With the structure above it's expected to run with the following command in Makefile:\r\n  \r\n    \r\n    $ node_modules/.bin/intl-imports.js frontend-component-footer frontend-component-header frontend-app-example\r\n  \r\n  \r\n  It will generate two type of files:\r\n  \r\n   - Main src/i18n/index.js which overrides the Micro-frontend provided with a sample output of:\r\n      \r\n      \"\"\"\r\n      import messagesFromFrontendComponentFooter from './messages/frontend-component-footer';\r\n      // Skipped import due to missing './messages/frontend-component-footer/index.js' likely due to empty translations.\r\n      import messagesFromFrontendAppExample from './messages/frontend-app-example';\r\n   \r\n      export default [\r\n        messagesFromFrontendComponentFooter,\r\n        messagesFromFrontendAppExample,\r\n      ];\r\n      \"\"\"\r\n  \r\n   - Each sub-directory has src/i18n/messages/frontend-component-header/index.js which is imported by the main file.:\r\n   \r\n      \"\"\"\r\n      import messagesOfArLanguage from './ar.json';\r\n      import messagesOfDeLanguage from './de.json';\r\n      import messagesOfEs419Language from './es_419.json';\r\n      export default {\r\n        'ar': messagesOfArLanguage,\r\n        'de': messagesOfDeLanguage,\r\n        'es-419': messagesOfEs419Language,\r\n      };\r\n     \"\"\"\r\n`;\r\n\r\nconst fs = require('fs');\r\nconst path = require('path');\r\nconst camelCase = require('lodash.camelcase');\r\n\r\nconst loggingPrefix = path.basename(`${__filename}`); // the name of this JS file\r\n\r\n// Header note for generated src/i18n/index.js file\r\nconst filesCodeGeneratorNoticeHeader = `// This file is generated by the openedx/frontend-platform's \"intl-import.js\" script.\r\n//\r\n// Refer to the i18n documents in https://docs.openedx.org/en/latest/developers/references/i18n.html to update\r\n// the file and use the Micro-frontend i18n pattern in new repositories.\r\n//\r\n`;\r\n\r\n/**\r\n * Create frontend-app-example/index.js file with proper imports.\r\n *\r\n * @param directory - a directory name containing .json files from Transifex e.g. \"frontend-app-example\".\r\n * @param log - Mockable process.stdout.write\r\n * @param writeFileSync - Mockable fs.writeFileSync\r\n * @param i18nDir - Path to `src/i18n` directory\r\n *\r\n * @return object - An object containing directory name and whether its \"index.js\" file was successfully written.\r\n */\r\nfunction generateSubdirectoryMessageFile({\r\n  directory,\r\n  log,\r\n  writeFileSync,\r\n  i18nDir,\r\n}) {\r\n  const importLines = [];\r\n  const messagesLines = [];\r\n  const counter = { nonEmptyLanguages: 0 };\r\n  const messagesDir = `${i18nDir}/messages`; // The directory of Micro-frontend i18n messages\r\n\r\n  try {\r\n    const files = fs.readdirSync(`${messagesDir}/${directory}`, { withFileTypes: true });\r\n    files.sort(); // Sorting ensures a consistent generated `index.js` order of imports cross-platforms.\r\n\r\n    const jsonFiles = files.filter(file => file.isFile() && file.name.endsWith('.json'));\r\n\r\n    if (!jsonFiles.length) {\r\n      log(`${loggingPrefix}: Not creating '${directory}/index.js' because no .json translation files were found.\\n`);\r\n      return {\r\n        directory,\r\n        isWritten: false,\r\n      };\r\n    }\r\n\r\n    jsonFiles.forEach((file) => {\r\n      const filename = file.name;\r\n      // Gets `fr_CA` from `fr_CA.json`\r\n      const languageCode = filename.replace(/\\.json$/, '');\r\n      // React-friendly language code fr_CA --> fr-ca\r\n      const reactIntlLanguageCode = languageCode.toLowerCase().replace(/_/g, '-');\r\n      // camelCase variable name\r\n      const messagesCamelCaseVar = camelCase(`messages_Of_${languageCode}_Language`);\r\n      const filePath = `${messagesDir}/${directory}/${filename}`;\r\n\r\n      try {\r\n        const entries = JSON.parse(fs.readFileSync(filePath, { encoding: 'utf8' }));\r\n\r\n        if (!Object.keys(entries).length) {\r\n          importLines.push(`// Note: Skipped empty '${filename}' messages file.`);\r\n          return; // Skip the language\r\n        }\r\n      } catch (e) {\r\n        importLines.push(`// Error: unable to parse '${filename}' messages file.`);\r\n        log(`${loggingPrefix}: NOTICE: Skipping '${directory}/${filename}' due to error: ${e}.\\n`);\r\n        return; // Skip the language\r\n      }\r\n\r\n      counter.nonEmptyLanguages += 1;\r\n      importLines.push(`import ${messagesCamelCaseVar} from './${filename}';`);\r\n      messagesLines.splice(1, 0, `  '${reactIntlLanguageCode}': ${messagesCamelCaseVar},`);\r\n    });\r\n\r\n    if (counter.nonEmptyLanguages) {\r\n      // See the help message above for sample output.\r\n      const messagesFileContent = [\r\n        filesCodeGeneratorNoticeHeader,\r\n        importLines.join('\\n'),\r\n        '\\nexport default {',\r\n        messagesLines.join('\\n'),\r\n        '};\\n',\r\n      ].join('\\n');\r\n\r\n      writeFileSync(`${messagesDir}/${directory}/index.js`, messagesFileContent);\r\n      return {\r\n        directory,\r\n        isWritten: true,\r\n      };\r\n    }\r\n    log(`${loggingPrefix}: Skipping '${directory}' because no languages were found.\\n`);\r\n  } catch (e) {\r\n    log(`${loggingPrefix}: NOTICE: Skipping '${directory}' due to error: ${e}.\\n`);\r\n  }\r\n\r\n  return {\r\n    directory,\r\n    isWritten: false,\r\n  };\r\n}\r\n\r\n/**\r\n * Create main `src/i18n/index.js` messages import file.\r\n *\r\n *\r\n * @param processedDirectories - List of directories with a boolean flag whether its \"index.js\" file is written\r\n *                               The format is \"[\\{ directory: \"frontend-component-example\", isWritten: false \\}, ...]\"\r\n * @param log - Mockable process.stdout.write\r\n * @param writeFileSync - Mockable fs.writeFileSync\r\n * @param i18nDir` - Path to `src/i18n` directory\r\n */\r\nfunction generateMainMessagesFile({\r\n  processedDirectories,\r\n  log,\r\n  writeFileSync,\r\n  i18nDir,\r\n}) {\r\n  const importLines = [];\r\n  const exportLines = [];\r\n\r\n  processedDirectories.forEach(processedDirectory => {\r\n    const { directory, isWritten } = processedDirectory;\r\n    if (isWritten) {\r\n      const moduleCamelCaseVariableName = camelCase(`messages_from_${directory}`);\r\n      importLines.push(`import ${moduleCamelCaseVariableName} from './messages/${directory}';`);\r\n      exportLines.push(`  ${moduleCamelCaseVariableName},`);\r\n    } else {\r\n      const skipMessage = `Skipped import due to missing '${directory}/index.js' likely due to empty translations.`;\r\n      importLines.push(`// ${skipMessage}.`);\r\n      log(`${loggingPrefix}: ${skipMessage}\\n`);\r\n    }\r\n  });\r\n\r\n  // See the help message above for sample output.\r\n  const indexFileContent = [\r\n    filesCodeGeneratorNoticeHeader,\r\n    importLines.join('\\n'),\r\n    '\\nexport default [',\r\n    exportLines.join('\\n'),\r\n    '];\\n',\r\n  ].join('\\n');\r\n\r\n  writeFileSync(`${i18nDir}/index.js`, indexFileContent);\r\n}\r\n\r\n/*\r\n * Main function of the file.\r\n */\r\nfunction main({\r\n  directories,\r\n  log,\r\n  writeFileSync,\r\n  pwd,\r\n}) {\r\n  const i18nDir = `${pwd}/src/i18n`; // The Micro-frontend i18n root directory\r\n\r\n  if (directories.includes('--help') || directories.includes('-h')) {\r\n    log(scriptHelpDocument);\r\n  } else if (!directories.length) {\r\n    log(scriptHelpDocument);\r\n    log(`${loggingPrefix}: Error: A list of directories is required.\\n`);\r\n  } else if (!fs.existsSync(i18nDir) || !fs.lstatSync(i18nDir).isDirectory()) {\r\n    log(scriptHelpDocument);\r\n    log(`${loggingPrefix}: Error: src/i18n directory was not found.\\n`);\r\n  } else {\r\n    const processedDirectories = directories.map(directory => generateSubdirectoryMessageFile({\r\n      directory,\r\n      log,\r\n      writeFileSync,\r\n      i18nDir,\r\n    }));\r\n    generateMainMessagesFile({\r\n      processedDirectories,\r\n      log,\r\n      writeFileSync,\r\n      i18nDir,\r\n    });\r\n  }\r\n}\r\n\r\nif (require.main === module) {\r\n  // Run the main() function if called from the command line.\r\n  main({\r\n    directories: process.argv.slice(2),\r\n    log: text => process.stdout.write(text),\r\n    writeFileSync: fs.writeFileSync,\r\n    pwd: process.env.PWD,\r\n  });\r\n}\r\n\r\nmodule.exports.main = main; // Allow tests to use the main function.\r\n"],"mappings":"AAAA;AAEA,IAAMA,kBAAkB,suEA6DvB;AAED,IAAMC,EAAE,GAAGC,OAAO,CAAC,IAAI,CAAC;AACxB,IAAMC,IAAI,GAAGD,OAAO,CAAC,MAAM,CAAC;AAC5B,IAAME,SAAS,GAAGF,OAAO,CAAC,kBAAkB,CAAC;AAE7C,IAAMG,aAAa,GAAGF,IAAI,CAACG,QAAQ,IAAAC,MAAA,CAAIC,UAAU,CAAE,CAAC,CAAC,CAAC;;AAEtD;AACA,IAAMC,8BAA8B,gSAKnC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASC,+BAA+BA,CAAAC,IAAA,EAKrC;EAAA,IAJDC,SAAS,GAAAD,IAAA,CAATC,SAAS;IACTC,GAAG,GAAAF,IAAA,CAAHE,GAAG;IACHC,aAAa,GAAAH,IAAA,CAAbG,aAAa;IACbC,OAAO,GAAAJ,IAAA,CAAPI,OAAO;EAEP,IAAMC,WAAW,GAAG,EAAE;EACtB,IAAMC,aAAa,GAAG,EAAE;EACxB,IAAMC,OAAO,GAAG;IAAEC,iBAAiB,EAAE;EAAE,CAAC;EACxC,IAAMC,WAAW,MAAAb,MAAA,CAAMQ,OAAO,cAAW,CAAC,CAAC;;EAE3C,IAAI;IACF,IAAMM,KAAK,GAAGpB,EAAE,CAACqB,WAAW,IAAAf,MAAA,CAAIa,WAAW,OAAAb,MAAA,CAAIK,SAAS,GAAI;MAAEW,aAAa,EAAE;IAAK,CAAC,CAAC;IACpFF,KAAK,CAACG,IAAI,CAAC,CAAC,CAAC,CAAC;;IAEd,IAAMC,SAAS,GAAGJ,KAAK,CAACK,MAAM,CAAC,UAAAC,IAAI;MAAA,OAAIA,IAAI,CAACC,MAAM,CAAC,CAAC,IAAID,IAAI,CAACE,IAAI,CAACC,QAAQ,CAAC,OAAO,CAAC;IAAA,EAAC;IAEpF,IAAI,CAACL,SAAS,CAACM,MAAM,EAAE;MACrBlB,GAAG,IAAAN,MAAA,CAAIF,aAAa,sBAAAE,MAAA,CAAmBK,SAAS,gEAA6D,CAAC;MAC9G,OAAO;QACLA,SAAS,EAATA,SAAS;QACToB,SAAS,EAAE;MACb,CAAC;IACH;IAEAP,SAAS,CAACQ,OAAO,CAAC,UAACN,IAAI,EAAK;MAC1B,IAAMO,QAAQ,GAAGP,IAAI,CAACE,IAAI;MAC1B;MACA,IAAMM,YAAY,GAAGD,QAAQ,CAACE,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC;MACpD;MACA,IAAMC,qBAAqB,GAAGF,YAAY,CAACG,WAAW,CAAC,CAAC,CAACF,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC;MAC3E;MACA,IAAMG,oBAAoB,GAAGnC,SAAS,gBAAAG,MAAA,CAAgB4B,YAAY,cAAW,CAAC;MAC9E,IAAMK,QAAQ,MAAAjC,MAAA,CAAMa,WAAW,OAAAb,MAAA,CAAIK,SAAS,OAAAL,MAAA,CAAI2B,QAAQ,CAAE;MAE1D,IAAI;QACF,IAAMO,OAAO,GAAGC,IAAI,CAACC,KAAK,CAAC1C,EAAE,CAAC2C,YAAY,CAACJ,QAAQ,EAAE;UAAEK,QAAQ,EAAE;QAAO,CAAC,CAAC,CAAC;QAE3E,IAAI,CAACC,MAAM,CAACC,IAAI,CAACN,OAAO,CAAC,CAACV,MAAM,EAAE;UAChCf,WAAW,CAACgC,IAAI,4BAAAzC,MAAA,CAA4B2B,QAAQ,qBAAkB,CAAC;UACvE,OAAO,CAAC;QACV;MACF,CAAC,CAAC,OAAOe,CAAC,EAAE;QACVjC,WAAW,CAACgC,IAAI,+BAAAzC,MAAA,CAA+B2B,QAAQ,qBAAkB,CAAC;QAC1ErB,GAAG,IAAAN,MAAA,CAAIF,aAAa,0BAAAE,MAAA,CAAuBK,SAAS,OAAAL,MAAA,CAAI2B,QAAQ,sBAAA3B,MAAA,CAAmB0C,CAAC,QAAK,CAAC;QAC1F,OAAO,CAAC;MACV;MAEA/B,OAAO,CAACC,iBAAiB,IAAI,CAAC;MAC9BH,WAAW,CAACgC,IAAI,WAAAzC,MAAA,CAAWgC,oBAAoB,eAAAhC,MAAA,CAAY2B,QAAQ,OAAI,CAAC;MACxEjB,aAAa,CAACiC,MAAM,CAAC,CAAC,EAAE,CAAC,QAAA3C,MAAA,CAAQ8B,qBAAqB,SAAA9B,MAAA,CAAMgC,oBAAoB,MAAG,CAAC;IACtF,CAAC,CAAC;IAEF,IAAIrB,OAAO,CAACC,iBAAiB,EAAE;MAC7B;MACA,IAAMgC,mBAAmB,GAAG,CAC1B1C,8BAA8B,EAC9BO,WAAW,CAACoC,IAAI,CAAC,IAAI,CAAC,EACtB,oBAAoB,EACpBnC,aAAa,CAACmC,IAAI,CAAC,IAAI,CAAC,EACxB,MAAM,CACP,CAACA,IAAI,CAAC,IAAI,CAAC;MAEZtC,aAAa,IAAAP,MAAA,CAAIa,WAAW,OAAAb,MAAA,CAAIK,SAAS,gBAAauC,mBAAmB,CAAC;MAC1E,OAAO;QACLvC,SAAS,EAATA,SAAS;QACToB,SAAS,EAAE;MACb,CAAC;IACH;IACAnB,GAAG,IAAAN,MAAA,CAAIF,aAAa,kBAAAE,MAAA,CAAeK,SAAS,yCAAsC,CAAC;EACrF,CAAC,CAAC,OAAOqC,CAAC,EAAE;IACVpC,GAAG,IAAAN,MAAA,CAAIF,aAAa,0BAAAE,MAAA,CAAuBK,SAAS,sBAAAL,MAAA,CAAmB0C,CAAC,QAAK,CAAC;EAChF;EAEA,OAAO;IACLrC,SAAS,EAATA,SAAS;IACToB,SAAS,EAAE;EACb,CAAC;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASqB,wBAAwBA,CAAAC,KAAA,EAK9B;EAAA,IAJDC,oBAAoB,GAAAD,KAAA,CAApBC,oBAAoB;IACpB1C,GAAG,GAAAyC,KAAA,CAAHzC,GAAG;IACHC,aAAa,GAAAwC,KAAA,CAAbxC,aAAa;IACbC,OAAO,GAAAuC,KAAA,CAAPvC,OAAO;EAEP,IAAMC,WAAW,GAAG,EAAE;EACtB,IAAMwC,WAAW,GAAG,EAAE;EAEtBD,oBAAoB,CAACtB,OAAO,CAAC,UAAAwB,kBAAkB,EAAI;IACjD,IAAQ7C,SAAS,GAAgB6C,kBAAkB,CAA3C7C,SAAS;MAAEoB,SAAS,GAAKyB,kBAAkB,CAAhCzB,SAAS;IAC5B,IAAIA,SAAS,EAAE;MACb,IAAM0B,2BAA2B,GAAGtD,SAAS,kBAAAG,MAAA,CAAkBK,SAAS,CAAE,CAAC;MAC3EI,WAAW,CAACgC,IAAI,WAAAzC,MAAA,CAAWmD,2BAA2B,wBAAAnD,MAAA,CAAqBK,SAAS,OAAI,CAAC;MACzF4C,WAAW,CAACR,IAAI,MAAAzC,MAAA,CAAMmD,2BAA2B,MAAG,CAAC;IACvD,CAAC,MAAM;MACL,IAAMC,WAAW,qCAAApD,MAAA,CAAqCK,SAAS,iDAA8C;MAC7GI,WAAW,CAACgC,IAAI,OAAAzC,MAAA,CAAOoD,WAAW,MAAG,CAAC;MACtC9C,GAAG,IAAAN,MAAA,CAAIF,aAAa,QAAAE,MAAA,CAAKoD,WAAW,OAAI,CAAC;IAC3C;EACF,CAAC,CAAC;;EAEF;EACA,IAAMC,gBAAgB,GAAG,CACvBnD,8BAA8B,EAC9BO,WAAW,CAACoC,IAAI,CAAC,IAAI,CAAC,EACtB,oBAAoB,EACpBI,WAAW,CAACJ,IAAI,CAAC,IAAI,CAAC,EACtB,MAAM,CACP,CAACA,IAAI,CAAC,IAAI,CAAC;EAEZtC,aAAa,IAAAP,MAAA,CAAIQ,OAAO,gBAAa6C,gBAAgB,CAAC;AACxD;;AAEA;AACA;AACA;AACA,SAASC,IAAIA,CAAAC,KAAA,EAKV;EAAA,IAJDC,WAAW,GAAAD,KAAA,CAAXC,WAAW;IACXlD,GAAG,GAAAiD,KAAA,CAAHjD,GAAG;IACHC,aAAa,GAAAgD,KAAA,CAAbhD,aAAa;IACbkD,GAAG,GAAAF,KAAA,CAAHE,GAAG;EAEH,IAAMjD,OAAO,MAAAR,MAAA,CAAMyD,GAAG,cAAW,CAAC,CAAC;;EAEnC,IAAID,WAAW,CAACE,QAAQ,CAAC,QAAQ,CAAC,IAAIF,WAAW,CAACE,QAAQ,CAAC,IAAI,CAAC,EAAE;IAChEpD,GAAG,CAACb,kBAAkB,CAAC;EACzB,CAAC,MAAM,IAAI,CAAC+D,WAAW,CAAChC,MAAM,EAAE;IAC9BlB,GAAG,CAACb,kBAAkB,CAAC;IACvBa,GAAG,IAAAN,MAAA,CAAIF,aAAa,kDAA+C,CAAC;EACtE,CAAC,MAAM,IAAI,CAACJ,EAAE,CAACiE,UAAU,CAACnD,OAAO,CAAC,IAAI,CAACd,EAAE,CAACkE,SAAS,CAACpD,OAAO,CAAC,CAACqD,WAAW,CAAC,CAAC,EAAE;IAC1EvD,GAAG,CAACb,kBAAkB,CAAC;IACvBa,GAAG,IAAAN,MAAA,CAAIF,aAAa,iDAA8C,CAAC;EACrE,CAAC,MAAM;IACL,IAAMkD,oBAAoB,GAAGQ,WAAW,CAACM,GAAG,CAAC,UAAAzD,SAAS;MAAA,OAAIF,+BAA+B,CAAC;QACxFE,SAAS,EAATA,SAAS;QACTC,GAAG,EAAHA,GAAG;QACHC,aAAa,EAAbA,aAAa;QACbC,OAAO,EAAPA;MACF,CAAC,CAAC;IAAA,EAAC;IACHsC,wBAAwB,CAAC;MACvBE,oBAAoB,EAApBA,oBAAoB;MACpB1C,GAAG,EAAHA,GAAG;MACHC,aAAa,EAAbA,aAAa;MACbC,OAAO,EAAPA;IACF,CAAC,CAAC;EACJ;AACF;AAEA,IAAIb,OAAO,CAAC2D,IAAI,KAAKS,MAAM,EAAE;EAC3B;EACAT,IAAI,CAAC;IACHE,WAAW,EAAEQ,OAAO,CAACC,IAAI,CAACC,KAAK,CAAC,CAAC,CAAC;IAClC5D,GAAG,EAAE,SAALA,GAAGA,CAAE6D,IAAI;MAAA,OAAIH,OAAO,CAACI,MAAM,CAACC,KAAK,CAACF,IAAI,CAAC;IAAA;IACvC5D,aAAa,EAAEb,EAAE,CAACa,aAAa;IAC/BkD,GAAG,EAAEO,OAAO,CAACM,GAAG,CAACC;EACnB,CAAC,CAAC;AACJ;AAEAR,MAAM,CAACS,OAAO,CAAClB,IAAI,GAAGA,IAAI,CAAC,CAAC","ignoreList":[]}