{"version":3,"file":"utils.js","names":["urlRegex","getUrlParts","url","found","match","_found","_slicedToArray","fullUrl","protocol","domain","path","endFilename","endFileExtension","query","hash","e","Error","concat","logFrontendAuthError","loggingService","error","prefixedMessageError","Object","create","message","logError","customAttributes","processAxiosError","axiosErrorObject","request","response","config","_objectSpread","httpErrorType","httpErrorRequestUrl","httpErrorRequestMethod","method","status","data","stringifiedData","JSON","stringify","responseIsHTML","includes","httpErrorResponseData","httpErrorStatus","httpErrorMessage","processAxiosErrorAndThrow"],"sources":["../../src/auth/utils.js"],"sourcesContent":["// Lifted from here: https://regexr.com/3ok5o\r\nconst urlRegex = /([a-z]{1,2}tps?):\\/\\/((?:(?!(?:\\/|#|\\?|&)).)+)(?:(\\/(?:(?:(?:(?!(?:#|\\?|&)).)+\\/))?))?(?:((?:(?!(?:\\.|$|\\?|#)).)+))?(?:(\\.(?:(?!(?:\\?|$|#)).)+))?(?:(\\?(?:(?!(?:$|#)).)+))?(?:(#.+))?/;\r\nconst getUrlParts = (url) => {\r\n  const found = url.match(urlRegex);\r\n  try {\r\n    const [\r\n      fullUrl,\r\n      protocol,\r\n      domain,\r\n      path,\r\n      endFilename,\r\n      endFileExtension,\r\n      query,\r\n      hash,\r\n    ] = found;\r\n\r\n    return {\r\n      fullUrl,\r\n      protocol,\r\n      domain,\r\n      path,\r\n      endFilename,\r\n      endFileExtension,\r\n      query,\r\n      hash,\r\n    };\r\n  } catch (e) {\r\n    throw new Error(`Could not find url parts from ${url}.`);\r\n  }\r\n};\r\n\r\nconst logFrontendAuthError = (loggingService, error) => {\r\n  const prefixedMessageError = Object.create(error);\r\n  prefixedMessageError.message = `[frontend-auth] ${error.message}`;\r\n  loggingService.logError(prefixedMessageError, prefixedMessageError.customAttributes);\r\n};\r\n\r\nconst processAxiosError = (axiosErrorObject) => {\r\n  const error = Object.create(axiosErrorObject);\r\n  const { request, response, config } = error;\r\n\r\n  if (!config) {\r\n    error.customAttributes = {\r\n      ...error.customAttributes,\r\n      httpErrorType: 'unknown-api-request-error',\r\n    };\r\n    return error;\r\n  }\r\n\r\n  const {\r\n    url: httpErrorRequestUrl,\r\n    method: httpErrorRequestMethod,\r\n  } = config;\r\n  /* istanbul ignore else: difficult to enter the request-only error case in a unit test */\r\n  if (response) {\r\n    const { status, data } = response;\r\n    const stringifiedData = JSON.stringify(data) || '(empty response)';\r\n    const responseIsHTML = stringifiedData.includes('<!DOCTYPE html>');\r\n    // Don't include data if it is just an HTML document, like a 500 error page.\r\n    /* istanbul ignore next */\r\n    const httpErrorResponseData = responseIsHTML ? '<Response is HTML>' : stringifiedData;\r\n    error.customAttributes = {\r\n      ...error.customAttributes,\r\n      httpErrorType: 'api-response-error',\r\n      httpErrorStatus: status,\r\n      httpErrorResponseData,\r\n      httpErrorRequestUrl,\r\n      httpErrorRequestMethod,\r\n    };\r\n    error.message = `Axios Error (Response): ${status} - See custom attributes for details.`;\r\n  } else if (request) {\r\n    error.customAttributes = {\r\n      ...error.customAttributes,\r\n      httpErrorType: 'api-request-error',\r\n      httpErrorMessage: error.message,\r\n      httpErrorRequestUrl,\r\n      httpErrorRequestMethod,\r\n    };\r\n    // This case occurs most likely because of intermittent internet connection issues\r\n    // but it also, though less often, catches CORS or server configuration problems.\r\n    error.message = 'Axios Error (Request): (Possible local connectivity issue.) See custom attributes for details.';\r\n  } else {\r\n    error.customAttributes = {\r\n      ...error.customAttributes,\r\n      httpErrorType: 'api-request-config-error',\r\n      httpErrorMessage: error.message,\r\n      httpErrorRequestUrl,\r\n      httpErrorRequestMethod,\r\n    };\r\n    error.message = 'Axios Error (Config): See custom attributes for details.';\r\n  }\r\n\r\n  return error;\r\n};\r\n\r\nconst processAxiosErrorAndThrow = (axiosErrorObject) => {\r\n  throw processAxiosError(axiosErrorObject);\r\n};\r\n\r\nexport {\r\n  getUrlParts,\r\n  logFrontendAuthError,\r\n  processAxiosError,\r\n  processAxiosErrorAndThrow,\r\n};\r\n"],"mappings":"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","ignoreList":[]}